!function(e,t,s,a){"use strict";var i="asDatepicker",n={firstDayOfWeek:1,mode:"single",displayMode:"dropdown",calendars:1,date:"today",keyboard:!0,rangeSeparator:"to",multipleSeparator:",",multipleSize:5,container:"body",position:"bottom",alwaysShow:!1,onceClick:!1,min:null,max:null,selectableDate:[],selectableYear:[],selectableMonth:[],selectableDay:[],selectableDayOfWeek:[],lang:"it",views:["days"],outputFormat:"dd/mm/yyyy",mobileMode:!1,namespace:"calendar",tplInputWrapper:function(){return'<div class="namespace-inputWrap"></div>'},tplWrapper:function(){return'<div class="namespace-wrap"></div>'},tplContent:function(){return'<div class="namespace-content"><div class="namespace-header"><div class="namespace-prev"><</div><div class="namespace-caption"></div><div class="namespace-next">></div></div><div class="namespace-days"></div><div class="namespace-months"></div><div class="namespace-years"></div><div class="namespace-buttons"><div class="namespace-button-cancel"></div><div class="namespace-button-save"></div></div></div>'},tplTitle:function(){return'<div class="namespace-title">test</div>'},onInit:null,onReady:null,onRender:null,onChange:null,onBeforeShow:null,onShow:null,onBeforeHide:null,onHide:null},h=e(t),r=e(s),o={},c=0,l=e[i]=function(t,s){var a=this,i=e(t).data();this.$el=e(t),this.defaultOptions=e.extend(!0,{},n,s,i),this.options=e.extend(!0,{},n,s,i),e.each(i,function(e,t){a.options[e]=a._parseHtmlString(e,t),a.defaultOptions[e]=a._parseHtmlString(e,t)}),this.namespace=this.options.namespace,this.$inputWrap=this.$el.addClass(this.namespace+"-input").wrap(this.options.tplInputWrapper().replace(/namespace/g,this.namespace)).parent(),this.$inputIcon=e('<i class="'+this.namespace+'-icon"></i>'),this.$inputIcon.appendTo(this.$inputWrap),this.$container=e(this.options.container),this._trigger("init"),this._init()};l.LABEL=o,l.localize=function(e,t){o[e]=t},l.localize("en",{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],buttons:["Cancel","Save"]}),l.localize("it",{days:["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato"],daysShort:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],months:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],monthsShort:["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"],buttons:["Annulla","Salva"]}),l.prototype={constructor:l,_init:function(){this.mode=this.options.mode,this.format=this._parseFormat("yyyy-mm-dd"),this.outputFormat=this._parseFormat(this.options.outputFormat||"yyyy/mm/dd"),this.focused=0,this.flag=c++,this.pickerHide=!1,this.selected=!1,this.showed=!1,this.bound=!1,this.hasKeyboard=this.options.keyboard,this.map={},this.views=[],this.isMobile=this.options.mobileMode;var t=this.options.tplWrapper().replace(/namespace/g,this.namespace),a=this.options.tplContent().replace(/namespace/g,this.namespace),i=this.options.tplTitle().replace(/namespace/g,this.namespace),n=o[this.options.lang].buttons;switch(this.$picker=e(t),this.mode){case"single":this.calendarsNum=1;break;case"range":this.calendarsNum=2;break;case"multiple":this.calendarsNum=this.isMobile?1:this.options.calendars,this.options.views=["days"]}for(var h=0;h<this.calendarsNum;h++)this.$picker.append(a),this.views[h]=this.options.views[h]||"days";if(this.isMobile){var r=s.innerWidth,l=s.innerHeight,d=Math.min(r,l);this.$el.attr("readonly","readonly"),this.$cover=e('<div class="'+this.namespace+'-cover"></div>'),this.$picker.append(i).addClass(this.namespace+"_isMobile"),this.$picker.css({"font-size":Math.round(.04*d)+"px"})}this.$picker.attr("tabindex","0"),this._initStatus(this.options.displayMode),this._initSections(),this._initDate();for(var u=0;u<this.calendarsNum;u++)this._manageViews(u),this.buttonCancels.eq(u).html(n[0]),this.buttonSaves.eq(u).html(n[1]);this._initShowHide(this.options.alwaysShow),this._setValue(),this._trigger("ready")},_initStatus:function(t){"inline"===t?(this.options.alwaysShow=!0,this.$picker.addClass(this.namespace+"_show"),this.$picker.on({focus:e.proxy(this._focus,this),blur:e.proxy(this._blur,this)})):"dropdown"===t&&(this.$el.on({focus:e.proxy(this._focus,this),blur:e.proxy(this._blur,this)}),this.$inputIcon.on("click.inputIcon",e.proxy(this._toggle,this)),this.$picker.appendTo(this.options.container))},_initSections:function(){this.calendars=this.$picker.find("."+this.namespace+"-content"),this.calendarPrevs=this.calendars.find("."+this.namespace+"-prev"),this.calendarCaptions=this.calendars.find("."+this.namespace+"-caption"),this.calendarNexts=this.calendars.find("."+this.namespace+"-next"),this.daypickers=this.calendars.find("."+this.namespace+"-days"),this.monthpickers=this.calendars.find("."+this.namespace+"-months"),this.yearpickers=this.calendars.find("."+this.namespace+"-years"),this.buttonCancels=this.calendars.find("."+this.namespace+"-button-cancel"),this.buttonSaves=this.calendars.find("."+this.namespace+"-button-save")},_initShowHide:function(e){!0===e&&this.show()},_initDate:function(){var e="today"===this.options.date?new Date:this._parseDate(this.options.date,this.format);this._date={},this._date.currentDate=[new Date(e)],"multiple"===this.mode?(this._date.selectedDate=[],this._date.focusDate=new Date(e),this._date.focusDate.setHours(0,0,0,0)):(this._date.selectedDate=[new Date(e)],this._date.focusDate=[new Date(e)]),this._date.currentDay=[],this._date.currentMonth=[],this._date.currentYear=[],this._date.currentMonthDate=[],this._date.currentYearDate=[],this._date.selectedDay=[],this._date.selectedMonth=[],this._date.selectedYear=[],this._date.selectedMonthDate=[],this._date.selectedYearDate=[],this._date.cache={},this._date.cache.currentDate=[],this._date.cache.selectedDate=[];for(var t=0;t<this.calendarsNum;t++)this._date.currentDate[t]=this._date.currentDate[t]||new Date(e),"multiple"===this.mode?this._setDate(this._date.currentDate[t],"month",this._date.currentDate[t].getMonth()+t):(this._date.selectedDate[t]=this._date.selectedDate[t]||new Date(e),this._date.selectedDate[t].setHours(0,0,0,0),this._date.focusDate[t]=this._date.focusDate[t]||new Date(e),this._date.focusDate[t].setHours(0,0,0,0)),this._updateDate(t)},_manageViews:function(e){switch(this.views[e]){case"days":this._generateDaypicker(e),this.calendars.eq(e).addClass(this.namespace+"_days").removeClass(this.namespace+"_months").removeClass(this.namespace+"_years");break;case"months":this._generateMonthpicker(e),this.calendars.eq(e).removeClass(this.namespace+"_days").addClass(this.namespace+"_months").removeClass(this.namespace+"_years");break;case"years":this._generateYearpicker(e),this.calendars.eq(e).removeClass(this.namespace+"_days").removeClass(this.namespace+"_months").addClass(this.namespace+"_years")}},_generateDaypicker:function(e){this._generateHeader(e,o[this.options.lang].months[this._date.currentMonth[e]]+" "+this._date.currentYear[e]),this.daypickers.eq(e).html(this._generateDays(e))},_generateMonthpicker:function(e){this._generateHeader(e,this._date.currentYear[e]),this.monthpickers.eq(e).html(this._generateMonths(e))},_generateYearpicker:function(e){this._generateHeader(e,this._date.currentYear[e]-7+" "+this.options.rangeSeparator+" "+(this._date.currentYear[e]+4)),this.yearpickers.eq(e).html(this._generateYears(e))},_generateHeader:function(e,t){this.calendarCaptions.eq(e).html(t),this._judgeLock(e)},_generateDays:function(e){var t,s,a,i=this._date.currentYear[e],n=this._date.currentMonth[e],h=new Date(i,n+1,0).getDate(),r=new Date(i,n,1).getDay(),c=new Date(i,n,0).getDate(),l=r-this.options.firstDayOfWeek,d='<div class="'+this.namespace+'-head">',u=[],p=[];l=l<0?7+l:l;for(var _=0;_<7;_++){var f=this.options.firstDayOfWeek+_>6?this.options.firstDayOfWeek+_-7:this.options.firstDayOfWeek+_;d+='<span title="'+o[this.options.lang].daysShort[f]+" giorno prova "+o[this.options.lang].daysShort[f]+' ">'+o[this.options.lang].daysShort[f]+"</span>"}d+='</div><div class="'+this.namespace+'-body"><div class="'+this.namespace+'-row">';for(var m=0;m<42;m++)t=m-l+1,u=[!1,!1,!1,!1],s=0,a="",m>0&&m%7==0&&(d+='</div><div class="'+this.namespace+'-row">'),m<l?(a=this.namespace+"_otherMonth",s=c-l+m+1,p[m]=new Date(i,n-1,s,0,0,0,0)):m>h+l-1?(a=this.namespace+"_otherMonth",s=t-h,p[m]=new Date(i,n+1,s,0,0,0,0)):(p[m]=new Date(i,n,t,0,0,0,0),s=t,this.hasKeyboard&&("multiple"===this.mode?Date.parse(p[m])===Date.parse(this._date.focusDate)&&(a+=" "+this.namespace+"_focus"):Date.parse(p[m])===Date.parse(this._date.focusDate[e])&&(a+=" "+this.namespace+"_focus"))),u=this._judgeStatus(e,"days",this.mode,u,p[m],this._date.selectedDate),d+='<span class="'+(a+=this._renderStatus(u))+'">'+s+"</span>";return d+="</div></div>"},_generateMonths:function(e){var t,s=this._date.currentYear[e],a="",i=o[this.options.lang].monthsShort,n=[],h=this._date.focusDate[e],r=[];a+='<div class="'+this.namespace+'-row">';for(var c=0;c<12;c++)r=[!1,!1,!1,!1],t="",c>0&&c%3==0&&(a+='</div><div class="'+this.namespace+'-row">'),n[c]=new Date(s,c,1,0,0,0,0),this.hasKeyboard&&Date.parse(n[c])===Date.parse(new Date(h.getFullYear(),h.getMonth(),1,0,0,0,0))&&(t+=" "+this.namespace+"_focus"),r=this._judgeStatus(e,"months",this.mode,r,n[c],this._date.selectedMonthDate),a+='<span class="month-'+c+" "+(t+=this._renderStatus(r))+'">'+i[c]+"</span>";return a+="</div>"},_generateYears:function(e){var t,s=this._date.currentYear[e],a="",i=0,n=[],h=this._date.focusDate[e],r=[];a+='<div class="'+this.namespace+'-row">';for(var o=0;o<12;o++)r=[!1,!1,!1,!1],t="",i=s-7+o,o>0&&o%3==0&&(a+='</div><div class="'+this.namespace+'-row">'),n[o]=new Date(i,0,1,0,0,0,0),this.hasKeyboard&&Date.parse(n[o])===Date.parse(new Date(h.getFullYear(),0,1,0,0,0,0))&&(t+=" "+this.namespace+"_focus"),r=this._judgeStatus(e,"years",this.mode,r,n[o],this._date.selectedYearDate),a+='<span class="'+(t+=this._renderStatus(r))+'">'+i+"</span>";return a+="</div>"},_judgeLock:function(e){var t,s,a=!1,i=!1;switch(this.mode){case"range":if(0===e){switch(this.views[e]){case"days":t=Date.parse(this._date.currentDate[e]),s=Date.parse(this._date.selectedMonthDate[1]);break;case"months":t=Date.parse(this._date.currentYearDate[e]),s=Date.parse(this._date.selectedYearDate[1]);break;case"years":t=new Date(this._date.currentYearDate[e]).setFullYear(this._date.currentYear[e]+4),s=Date.parse(this._date.selectedYearDate[1])}i=!this._setPoint("<",i,t,s)}else{switch(this.views[e]){case"days":t=Date.parse(this._date.currentDate[e]),s=Date.parse(this._date.selectedMonthDate[0]);break;case"months":t=Date.parse(this._date.currentYearDate[e]),s=Date.parse(this._date.selectedYearDate[0]);break;case"years":t=new Date(this._date.currentYearDate[e]).setFullYear(this._date.currentYear[e]-7),s=Date.parse(this._date.selectedYearDate[0])}a=!this._setPoint(">",a,t,s)}break;case"multiple":this.calendarsNum>1&&(0===e?i=!0:a=e===this.calendarsNum-1||(i=!0))}!0===a?this.calendarPrevs.eq(e).addClass(this.namespace+"_blocked"):this.calendarPrevs.eq(e).removeClass(this.namespace+"_blocked"),!0===i?this.calendarNexts.eq(e).addClass(this.namespace+"_blocked"):this.calendarNexts.eq(e).removeClass(this.namespace+"_blocked")},_judgeSection:function(e,t,s){var a=!0;return(e<t||e>s)&&(a=!1),a},_judgeSections:function(t,s,i,n){var h=this,r=!1;switch(t){case"date":if(n)s=Date.parse(s),e.each(i,function(e,t){if(!r)switch(t.length){case a:s===Date.parse(t)&&(r=!0);break;case 2:r=h._judgeSection(s,Date.parse(t[0]),Date.parse(t[1]))}});else{var o=Date.parse(s[0]),c=Date.parse(s[1]);e.each(i,function(e,t){if(!r)switch(t.length){case a:Date.parse(t)>=o&&Date.parse(t)<=c&&(r=!0);break;case 2:r=!0,(c<Date.parse(t[0])||o>Date.parse(t[1]))&&(r=!1)}})}break;case"block":e.each(i,function(e,t){if(!r)switch(t.length){case a:s===t&&(r=!0);break;case 2:r=h._judgeSection(s,t[0],t[1])}});break;case"dayOfWeek":var l=s.getDay();e.each(i,function(e,t){if(!r)switch(t.length){case a:l===t&&(r=!0);break;case 2:r=h._judgeSection(l,t[0],t[1])}})}return r},_judgeStatus:function(e,t,s,a,i,n){var h=a[0],r=a[1],o=a[2];switch(h=!this._isSelectable(t,i.getFullYear(),i.getMonth(),i.getDate()),s){case"single":r=this._setPoint("=",r,Date.parse(i),Date.parse(n[e]));break;case"range":r=this._setPoint("=",r,Date.parse(i),Date.parse(n[e])),o=this._setSection(o,i,n[0],n[1]),0===e?h=this._setPoint(">",h,Date.parse(i),Date.parse(n[1])):1===e&&(h=this._setPoint("<",h,Date.parse(i),Date.parse(n[0])));break;case"multiple":for(var c=0;c<this._date.selectedDate.length;c++)Date.parse(i)===n[c]&&(r=!0)}return[h,r,o]},_setPoint:function(e,t,s,a){var i=t;switch(e){case"=":s===a&&(i=!0);break;case"<":s<a&&(i=!0);break;case">":s>a&&(i=!0)}return i},_setSection:function(e,t,s,a){var i=e,n=Date.parse(t),h=Date.parse(s),r=Date.parse(a);return n>=h&&n<=r&&(i=!0),i},_isSelectable:function(e,t,s,a){var i,n,h,r,o=!0,c=this._parseDate(this.options.min,this.format),l=this._parseDate(this.options.max,this.format),d=this._parseDateArr(this.options.selectableDate,this.format),u=this._parseDateSection(this.options.selectableYear),p=this._parseDateSection(this.options.selectableMonth),_=this._parseDateSection(this.options.selectableDay),f=this._parseDateSection(this.options.selectableDayOfWeek);switch(e){case"years":h=[i=new Date(t,0,1),n=new Date(t+1,0,0)],r=!1;break;case"months":h=[i=new Date(t,s,1),n=new Date(t,s+1,0)],r=!1;break;case"days":i=n=h=new Date(t,s,a),r=!0}return c&&c>n&&(o=!1),l&&l<i&&(o=!1),o&&d.length>0&&(o=this._judgeSections("date",h,d,r)),o&&u.length>0&&(o=this._judgeSections("block",t,u)),"months"!==e&&"days"!==e||o&&p.length>0&&(o=this._judgeSections("block",s,p)),"days"===e&&(o&&_.length>0&&(o=this._judgeSections("block",a,_)),o&&f.length>0&&(o=this._judgeSections("dayOfWeek",new Date(t,s,a),f))),o},_renderStatus:function(e){var t=e[0],s=e[1],a=e[2],i="";return!0===e[3]?i=" "+this.namespace+"_untouchable":(!0===t&&(i=" "+this.namespace+"_untouchable"),!0===a&&(i+=" "+this.namespace+"_inRange")),!0===s&&(i+=" "+this.namespace+"_active"),i},_changeView:function(e,t){switch(e){case"caption":"multiple"!==this.options.mode&&("days"===this.views[t]?this.views[t]="months":"months"===this.views[t]&&(this.views[t]="years"));break;case"content":"years"===this.views[t]?this.views[t]="months":"months"===this.views[t]&&(this.views[t]="days");break;case"higher":"multiple"!==this.options.mode&&("days"===this.views[t]?this.views[t]="months":"months"===this.views[t]&&(this.views[t]="years"));break;case"lower":"multiple"!==this.options.mode&&("years"===this.views[t]?this.views[t]="months":"months"===this.views[t]&&(this.views[t]="days"))}},_setDate:function(e,t,s){if("object"==typeof t)for(var a in t)switch(a){case"day":e.setDate(t[a]);break;case"month":e.setMonth(t[a]);break;case"year":e.setYear(t[a])}else switch(t){case"day":e.setDate(s);break;case"month":e.setMonth(s);break;case"year":e.setYear(s)}},_formatDate:function(e,t){var s={d:(e=new Date(e)).getDate(),m:e.getMonth()+1,yy:e.getFullYear().toString().substring(2),yyyy:e.getFullYear()};s.dd=(s.d<10?"0":"")+s.d,s.mm=(s.m<10?"0":"")+s.m,e=[];for(var a=0,i=t.parts.length;a<i;a++)e.push(s[t.parts[a]]);return e.join(t.separator)},_stringSeparate:function(e,t){var s=new RegExp("[.\\"+t+"\\s].*?"),a=e.match(s);return e.split(a)},_parseHtmlString:function(e,t){var s=[];if("object"==typeof l.defaults[e]){for(var a,i=this._stringSeparate(t,","),n=0;n<i.length;n++)a=(a=this._stringSeparate(i[n],">")).length>1?{from:a[0],to:a[1]}:a[0],s.push(a);return s}return t},_parseFormat:function(e){var t=e.match(/[.\/\-\s].*?/),s=e.split(/\W+/)||s;if(!s||0===s.length)throw new Error("Invalid date format.");return{separator:t,parts:s}},_parseDate:function(e,t){if(null!==e){var s=new Date,a=s.getDate();switch(typeof e){case"string":if(e.length<5)s.setHours(0,0,0,0),s.setDate(a+Number(e));else{var i,n=e.split(t.separator)||n;if(s.setHours(0,0,0,0),n.length===t.parts.length)for(var h=0,r=t.parts.length;h<r;h++){if("1"===(i=parseInt(n[h],10)||1))return;switch(t.parts[h]){case"dd":case"d":s.setDate(i);break;case"mm":case"m":s.setMonth(i-1,1);break;case"yy":s.setFullYear(2e3+i);break;case"yyyy":s.setFullYear(i)}}}break;case"number":s.setHours(0,0,0,0),s.setDate(a+e)}return s}return null},_parseDateArr:function(e,t){for(var s=[],a=0,i=0;i<e.length;i++)if("string"==typeof e[i])s[a++]=this._parseDate(e[i],t);else if("object"==typeof e[i]){var n,h,r=e[i];for(var o in r)switch(o){case"from":n=r[o];break;case"to":h=r[o]}s[a++]=[this._parseDate(n,t),this._parseDate(h,t)]}return s},_parseDateSection:function(e){for(var t=[],s=0,a=0;a<e.length;a++)if("number"==typeof e[a])t[s++]=e[a];else if("string"==typeof e[a])t[s++]=Number(e[a]);else if("object"==typeof e[a]){var i,n,h=e[a];for(var r in h)switch(r){case"from":i=Number(h[r]);break;case"to":n=Number(h[r])}t[s++]=[i,n]}return t},_updateDate:function(e){this._date.currentDate[e].setDate(1),this._date.currentDate[e].setHours(0,0,0,0),this._date.currentDay[e]=this._date.currentDate[e].getDate(),this._date.currentMonth[e]=this._date.currentDate[e].getMonth(),this._date.currentYear[e]=this._date.currentDate[e].getFullYear(),this._date.currentMonthDate[e]=new Date(this._date.currentYear[e],this._date.currentMonth[e],1,0,0,0,0),this._date.currentYearDate[e]=new Date(this._date.currentYear[e],0,1,0,0,0,0),"multiple"!==this.mode&&(this._date.selectedDay[e]=this._date.selectedDate[e].getDate(),this._date.selectedMonth[e]=this._date.selectedDate[e].getMonth(),this._date.selectedYear[e]=this._date.selectedDate[e].getFullYear(),this._date.selectedMonthDate[e]=new Date(this._date.selectedYear[e],this._date.selectedMonth[e],1,0,0,0,0),this._date.selectedYearDate[e]=new Date(this._date.selectedYear[e],0,1,0,0,0,0))},_position:function(){var e,t,a=this.$picker.outerHeight(),i=this.$picker.outerWidth(),n=this.$container.height()||s.innerHeight,h=this.$el.offset().top,r=this.$el.offset().left,o=this.$el.outerHeight(),c=this.$el.outerWidth(),l=s.innerWidth,d=s.innerHeight,u=this.$container.scrollLeft()||0,p=this.options.position;if(this.isMobile)e=(l-i)/2,t=(d-a)/2;else{switch(p){case"bottom":case"right":case"left":h+o+a>n&&("bottom"===p?p="top":(p="left")?p="leftTop":(p="right")&&(p="rightTop"));break;case"top":case"rightTop":case"leftTop":h-a<0&&("top"===p?p="bottom":(p="leftTop")?p="left":(p="rightTop")&&(p="right"))}switch(p){case"top":e=r+u,t=h-a;break;case"right":e=r+c+u,t=h;break;case"bottom":e=r+u,t=h+o;break;case"left":e=r-i+u,t=h;break;case"rightTop":e=r+c+u,t=h-a+o;break;case"leftTop":e=r-i+u,t=h-a+o}}this.$picker.css({left:e,top:t})},_toggle:function(){this.showed?(this.pickerHide=!0,this._blur()):this._focus()},_focus:function(){"dropdown"===this.options.displayMode&&!1===this.showed&&this.show(),this.hasKeyboard&&this._keyboard.init(this)},_blur:function(){"dropdown"===this.options.displayMode&&!0===this.pickerHide&&(this.hide(),this.pickerHide=!1),this.hasKeyboard&&this._keyboard.destroy(this)},_trigger:function(e){var t=arguments.length>1?Array.prototype.slice.call(arguments,1).push(this):this;this.$el.trigger(i+"::"+e,t);var s="on"+(e=e.replace(/\b\w+\b/g,function(e){return e.substring(0,1).toUpperCase()+e.substring(1)})),n=arguments.length>1?Array.prototype.slice.call(arguments,1):a;"function"==typeof this.options[s]&&this.options[s].apply(this,n)},_click:function(t){var s=e(t.target);if(0===s.closest(this.$inputIcon).length&&0===s.closest(this.$picker).length&&0===s.closest(this.$el).length&&!1===this.options.alwaysShow)this.isMobile?this.mobileCancel(0):this.hide();else if(1!==s.closest(this.$el).length&&1===s.closest(this.$picker).length){var a=e(t.target).closest("div"),i=e(t.target).closest("span");if(1===a.parent("."+this.namespace+"-header").length){var n=a.parents("."+this.namespace+"-content").index();switch(a[0].className){case this.namespace+"-caption":this._changeView("caption",n),this._manageViews(n);break;case this.namespace+"-prev":this.prev(n);break;case this.namespace+"-next":this.next(n)}}if(1===i.length){var h=i.parents("."+this.namespace+"-content").index();if(!i.hasClass(this.namespace+"_otherMonth")&&!i.hasClass(this.namespace+"_untouchable")&&1!==i.parent("."+this.namespace+"-head").length){switch(this._changeValue(i,h),this._changeView("content",h),this._updateDate(h),this.mode){case"single":"days"===this.views[h]&&(this.selected=!0),this._manageViews(h);break;case"range":this._manageViews(0),this._manageViews(1);break;case"multiple":this._manageViews(h-1),this._manageViews(h),this._manageViews(h+1)}this.isMobile||this._setValue()}}if(1===a.parent("."+this.namespace+"-buttons").length){var r=a.parents("."+this.namespace+"-content").index();a[0].className===this.namespace+"-button-save"?this.mobileEnter(r):this.mobileCancel(r)}this.isMobile||(!0===this.selected&&!1===this.options.alwaysShow&&!0===this.options.onceClick?this.hide():"dropdown"===this.options.displayMode&&this.$el.focus())}t.preventDefault()},_changeValue:function(t,s){var a="",i="",n=this;switch(this.views[s]){case"years":a=parseInt(t.text(),10),this._date.currentDate[s].setYear(a);break;case"months":a=Number(t.attr("class").match(/month\-([0-9]+)/)[1]),this._date.currentDate[s].setMonth(a);break;case"days":switch(a=parseInt(t.text(),10),i=new Date(this._date.currentYear[s],this._date.currentMonth[s],a,0,0,0,0),this.options.mode){case"single":case"range":this._date.selectedDate[s]=i;break;case"multiple":var h=Date.parse(i);e.inArray(h,this._date.selectedDate)>-1?e.each(this._date.selectedDate,function(e,t){t===h&&n._date.selectedDate.splice(e,1)}):this._date.selectedDate.length<this.options.multipleSize&&this._date.selectedDate.push(h)}}},_setValue:function(){switch(this.mode){case"single":var e=this._formatDate(this._date.selectedDate[0],this.outputFormat);this.$el.val(e);break;case"range":var t=this._formatDate(this._date.selectedDate[0],this.outputFormat),s=this._formatDate(this._date.selectedDate[1],this.outputFormat);this.$el.val(t+" "+this.options.rangeSeparator+" "+s);break;case"multiple":for(var a,n="",h=0;h<this._date.selectedDate.length;h++)a=this._formatDate(this._date.selectedDate[h],this.outputFormat),0===n.length?n+=a:n+=this.options.multipleSeparator+a;this.$el.val(n)}this._trigger("change",this.getDate("yyyy-mm-dd"),this.options.name,i),this.oldValue=this.$el.val()},_prevent:function(e){e.preventDefault?e.preventDefault():e.returnvalue=!1},_removeEvents:function(){"inline"===this.options.displayMode?this.picker.off("click.picke"):h.off("click."+this.flag),this.$el.off("focus"),this.$el.off("blur")},prev:function(e,t){this.touchflag=!1;var s=this._date.currentDate[e];switch(this.views[e]){case"days":var a;if("multiple"===this.mode)if(t)if(0===this.focused)for(var i=0;i<this.calendarsNum;i++)this._date.currentDate[i].setMonth(this._date.currentMonth[i]-1),this._updateDate(i),this._manageViews(i);else--this.focused,this._manageViews(e),this._manageViews(e-1);else{a=new Date(s.getFullYear(),s.getMonth(),0).getDate(),this._date.focusDate.getDate()>a&&this._date.focusDate.setDate(a),this._date.focusDate.setMonth(this._date.focusDate.getMonth()-1);for(var n=0;n<this.calendarsNum;n++)this._date.currentDate[n].setMonth(this._date.currentMonth[n]-1),this._updateDate(n),this._manageViews(n)}else s.setMonth(this._date.currentMonth[e]-1),this.hasKeyboard&&(a=new Date(s.getFullYear(),s.getMonth(),0).getDate(),this._date.focusDate[e].getDate()>a&&this._date.focusDate[e].setDate(a),this._date.focusDate[e]=new Date(s.getFullYear(),s.getMonth(),this._date.focusDate[e].getDate(),0,0,0,0));break;case"months":s.setYear(this._date.currentYear[e]-1),this.hasKeyboard&&(this._date.focusDate[e]=new Date(s.getFullYear(),this._date.focusDate[e].getMonth(),this._date.focusDate[e].getDate(),0,0,0,0));break;case"years":s.setYear(this._date.currentYear[e]-12),this.hasKeyboard&&t&&(this._date.focusDate[e]=new Date(this._date.focusDate[e].getFullYear()-12,this._date.focusDate[e].getMonth(),this._date.focusDate[e].getDate(),0,0,0,0))}this._updateDate(e),this._manageViews(e)},next:function(e,t){this.touchflag=!1;var s=this._date.currentDate[e];switch(this.views[e]){case"days":var a;if("multiple"===this.mode)if(t)if(this.focused===this.calendarsNum-1)for(var i=0;i<this.calendarsNum;i++)this._date.currentDate[i].setMonth(this._date.currentMonth[i]+1),this._updateDate(i),this._manageViews(i);else++this.focused,this._manageViews(e),this._manageViews(e+1);else{a=new Date(s.getFullYear(),s.getMonth()+2,0).getDate(),this._date.focusDate.getDate()>a&&this._date.focusDate.setDate(a),this._date.focusDate.setMonth(this._date.focusDate.getMonth()+1);for(var n=0;n<this.calendarsNum;n++)this._date.currentDate[n].setMonth(this._date.currentMonth[n]+1),this._updateDate(n),this._manageViews(n)}else s.setMonth(this._date.currentMonth[e]+1),this.hasKeyboard&&(a=new Date(s.getFullYear(),s.getMonth()+1,0).getDate(),this._date.focusDate[e].getDate()>a&&this._date.focusDate[e].setDate(a),this._date.focusDate[e]=new Date(s.getFullYear(),s.getMonth(),this._date.focusDate[e].getDate(),0,0,0,0));break;case"months":s.setYear(this._date.currentYear[e]+1),this.hasKeyboard&&(this._date.focusDate[e]=new Date(s.getFullYear(),this._date.focusDate[e].getMonth(),this._date.focusDate[e].getDate(),0,0,0,0));break;case"years":s.setYear(this._date.currentYear[e]+12),this.hasKeyboard&&t&&(this._date.focusDate[e]=new Date(this._date.focusDate[e].getFullYear()+12,this._date.focusDate[e].getMonth(),this._date.focusDate[e].getDate(),0,0,0,0))}this._updateDate(e),this._manageViews(e)},mobilePrev:function(e){this.calendars.eq(e).removeClass(this.namespace+"_show"),this.calendars.eq(e-1).addClass(this.namespace+"_show")},mobileNext:function(e){this.calendars.eq(e).removeClass(this.namespace+"_show"),this.calendars.eq(e+1).addClass(this.namespace+"_show")},mobileInteDate:function(e){"multiple"===this.mode?this._date.selectedDate.length>0&&(this._date.currentDate[0]=new Date(this._date.selectedDate[0])):this._date.currentDate[e]=new Date(this._date.selectedDate[e]),this.views[e]="days",this._updateDate(e)},mobileEnter:function(e){"range"===this.mode&&0===e?(this.mobileNext(e),this.views[e]="days"):(this.mobileInteDate(e),this._setValue(),this.hide()),this._manageViews(e)},mobileCancel:function(e){1===e?(this.mobilePrev(e),this.views[e]="days"):(this.dateTransform(this._date.cache,this._date),this.mobileInteDate(e),this.hide()),this._manageViews(e)},dateTransform:function(t,s){var a=this;s.currentDate=[],s.selectedDate=[],e.each(t.currentDate,function(e,t){s.currentDate[e]=new Date(t)}),e.each(t.selectedDate,function(e,t){var i=new Date(t);s.selectedDate[e]="multiple"===a.mode?Date.parse(i):i})},show:function(){var t=this;if(this.isMobile&&this.dateTransform(this._date,this._date.cache),"inline"===this.options.displayMode)this._trigger("beforeShow"),this.$picker.on("mouseDown."+this.flag,function(e){t._prevent(e)}),this.$picker.on("click."+this.flag,function(e){t._click.call(t,e)});else if(!1===this.showed){if(this._trigger("beforeShow"),this.$inputWrap.addClass(this.namespace+"_active"),this.$picker.addClass(this.namespace+"_show"),this.isMobile){this.calendars.eq(0).addClass(this.namespace+"_show"),"range"===this.mode&&this.calendars.eq(1).removeClass(this.namespace+"_show"),e("body").append(this.$cover).css("overflow","hidden"),h.on("scrollstart."+this.flag,function(e){e.preventDefault()}),h.on("tap."+this.flag,function(e){t._click.call(t,e)});var s=function(e){var a=e.swipestart.coords[0],i=e.swipestop.coords[0];i>a?t.prev.call(t,0):i<a&&t.next.call(t,0),h.one("swipe."+t.flag,s)};h.one("swipe."+this.flag,s)}else h.on("click."+this.flag,function(e){t._click.call(t,e)});this._position(),this.showed=!0,r.on("resize."+this.flag,function(){t._position()}),this.$picker.on("mousedown."+this.flag,function(e){t._prevent(e)})}return this._trigger("show"),this},hide:function(){return!0===this.showed&&(this._trigger("beforeHide"),this.selected=!1,this.$inputWrap.removeClass(this.namespace+"_active"),this.$picker.removeClass(this.namespace+"_show"),this.showed=!1,this.$picker.off("mousedown."+this.flag),h.off("click."+this.flag),r.off("resize."+this.flag),this.isMobile&&(e("body").css("overflow","auto"),this.$cover.remove(),h.off("click."+this.flag+" tap."+this.flag+" scrollstart."+this.flag+" swipe."+this.flag)),this.$el.blur(),this._trigger("hide")),this},getWrap:function(){return this.picker},getInput:function(){return this.$el},getDate:function(e){if(e===a)return this._date.selectedDate;for(var t=this._parseFormat(e),s=[],i=0;i<this._date.selectedDate.length;i++)s[i]=this._formatDate(this._date.selectedDate[i],t);return s},multipleClear:function(){this._date.selectedDate=[];for(var e=0;e<this.calendarsNum;e++)this._manageViews(e);this._setValue()},destroy:function(){this.$el.removeData("asDatepicker"),this._removeEvents(),this.$picker.remove()},update:function(e){if(void 0!==e)for(var t in e)this.options[t]=e[t];this._removeEvents(),this.$picker.remove(),this._init()},reset:function(e){for(var t in this.defaultOptions)this.options[t]=this.defaultOptions[t];if(void 0!==e)for(var s in e)this.options[s]=e[s];this._removeEvents(),this.$picker.remove(),this._init()},_keyboard:{init:function(e){this.attach(e,this.gather(e))},destroy:function(e){"dropdown"===e.options.displayMode?e.$el.off("keydown.dropdown"):e.$picker.off("keydown.inline"),e.bound=!1},keys:function(){return{LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,ESC:27,CTRL:17,ALT:18}},prevDate:function(){var e=this.focused,t="multiple"===this.mode?this._date.focusDate:this._date.focusDate[e],s="multiple"!==this.mode&&this.calendarPrevs.eq(this.focused).hasClass(this.namespace+"_blocked");switch(this.views[e]){case"days":Date.parse(t)===Date.parse(this._date.currentDate[e])?s||(t.setDate(t.getDate()-1),this.prev(e,!0)):(t.setDate(t.getDate()-1),this._manageViews(e));break;case"months":0===t.getMonth()?s||(t.setMonth(t.getMonth()-1),this.prev(e)):(t.setMonth(t.getMonth()-1),this._manageViews(e));break;case"years":t.getFullYear()===this._date.currentYear[e]-7?s||(t.setFullYear(t.getFullYear()-1),this.prev(e)):(t.setFullYear(t.getFullYear()-1),this._manageViews(e))}},nextDate:function(){var e=this.focused,t="multiple"===this.mode?this._date.focusDate:this._date.focusDate[e],s="multiple"!==this.mode&&this.calendarNexts.eq(this.focused).hasClass(this.namespace+"_blocked");switch(this.views[e]){case"days":Date.parse(t)===Date.parse(new Date(this._date.currentYear[e],this._date.currentMonth[e]+1,0))?s||(t.setDate(t.getDate()+1),this.next(e,!0)):(t.setDate(t.getDate()+1),this._manageViews(e));break;case"months":11===t.getMonth()?s||(t.setMonth(t.getMonth()+1),this.next(e)):(t.setMonth(t.getMonth()+1),this._manageViews(e));break;case"years":t.getFullYear()===this._date.currentYear[e]+4?s||(t.setFullYear(t.getFullYear()+1),this.next(e)):(t.setFullYear(t.getFullYear()+1),this._manageViews(e))}},upLine:function(){var e=this.focused,t="multiple"===this.mode?this._date.focusDate:this._date.focusDate[e],s="multiple"!==this.mode&&this.calendarPrevs.eq(this.focused).hasClass(this.namespace+"_blocked");switch(this.views[e]){case"days":new Date(t.getFullYear(),t.getMonth(),t.getDate()-7).setDate(1)===new Date(this._date.currentDate[e]).setMonth(this._date.currentMonth[e]-1)?s||(t.setDate(t.getDate()-7),this.prev(e,!0)):(t.setDate(t.getDate()-7),this._manageViews(e));break;case"months":0===t.getMonth()||1===t.getMonth()||2===t.getMonth()?s||(t.setMonth(t.getMonth()-3),this.prev(e)):(t.setMonth(t.getMonth()-3),this._manageViews(e));break;case"years":t.getFullYear()<this._date.currentYear[e]-4?s||(t.setFullYear(t.getFullYear()-3),this.prev(e)):(t.setFullYear(t.getFullYear()-3),this._manageViews(e))}},downLine:function(){var e=this.focused,t="multiple"===this.mode?this._date.focusDate:this._date.focusDate[e],s="multiple"!==this.mode&&this.calendarNexts.eq(this.focused).hasClass(this.namespace+"_blocked");switch(this.views[e]){case"days":new Date(t.getFullYear(),t.getMonth(),t.getDate()+7).setDate(1)===new Date(this._date.currentDate[e]).setMonth(this._date.currentMonth[e]+1)?s||(t.setDate(t.getDate()+7),this.next(e,!0)):(t.setDate(t.getDate()+7),this._manageViews(e));break;case"months":9===t.getMonth()||10===t.getMonth()||11===t.getMonth()?s||(t.setMonth(t.getMonth()+3),this.next(e)):(t.setMonth(t.getMonth()+3),this._manageViews(e));break;case"years":t.getFullYear()>this._date.currentYear[e]+1?s||(t.setFullYear(t.getFullYear()+3),this.next(e)):(t.setFullYear(t.getFullYear()+3),this._manageViews(e))}},prevPage:function(){"multiple"===this.mode?this.prev(this.focused):this.calendarPrevs.eq(this.focused).hasClass(this.namespace+"_blocked")||this.prev(this.focused,!0)},nextPage:function(){"multiple"===this.mode?this.next(this.focused):this.calendarNexts.eq(this.focused).hasClass(this.namespace+"_blocked")||this.next(this.focused,!0)},higherView:function(){if("multiple"!==this.mode){var e=this.focused;this._changeView("higher",e),this._manageViews(e)}},prevCalendar:function(){if("multiple"!==this.mode){var e=this.calendars.length;--this.focused<0&&(this.focused=e)}},nextCalendar:function(){if("multiple"!==this.mode){var e=this.calendars.length;++this.focused>=e&&(this.focused=0)}},updateValue:function(t){var s=t.focused,a="multiple"===t.mode?t._date.focusDate:t._date.focusDate[s];if(!t.calendars.eq(s).find("."+t.namespace+"_focus").hasClass(t.namespace+"_untouchable")){switch(t.views[s]){case"days":switch(t.options.mode){case"single":case"range":t._date.selectedDate[s]=new Date(a);break;case"multiple":var i=Date.parse(new Date(a));e.inArray(i,t._date.selectedDate)>-1?e.each(t._date.selectedDate,function(e,s){if(s===i)return t._date.selectedDate.splice(e,1),!1}):t._date.selectedDate.push(i)}break;case"months":t._date.currentDate[s].setMonth(a.getMonth()),t.views[s]="days";break;case"years":t._date.currentDate[s].setFullYear(a.getFullYear()),t.views[s]="months"}t._updateDate(s),"range"===t.mode?(t._manageViews(0),t._manageViews(1)):"multiple"===t.mode?(t._manageViews(s-1),t._manageViews(s),t._manageViews(s+1)):t._manageViews(s),t._setValue()}},enter:function(){var t,s,a=this.$el.val(),i=this;if(a===this.oldValue||""===this.oldValue)this._keyboard.updateValue(this);else switch(this.mode){case"single":var n=Date.parse(a);n&&(this._date.selectedDate[0]=new Date(n),this._date.currentDate[0]=new Date(this._date.selectedDate[0]),this._updateDate(0),this._manageViews(0));break;case"range":s=this._stringSeparate(a,this.options.rangeSeparator);var h=Date.parse(s[0]),r=Date.parse(s[1]);if(2===s.length?(t=!0,h&&r?h>r&&(t=!1):t=!1):t=!1,!0===t){this._date.selectedDate[0]=new Date(h),this._date.selectedDate[1]=new Date(r);for(var o=0;o<2;o++)this._date.currentDate[o]=new Date(this._date.selectedDate[o]),this._updateDate(o),this._manageViews(o)}else this._keyboard.updateValue(this);break;case"multiple":s=this._stringSeparate(a,this.options.multipleSeparator);var c=[];t=!0;for(var l=0;l<s.length;l++)c.push(Date.parse(s[l])),Date.parse(s[l])||(t=!1);if(!0===t){this._date.selectedDate=[];for(var d=0;d<c.length;d++)e.inArray(c[d],this._date.selectedDate)>-1?e.each(this._date.selectedDate,function(e,t){t===c[d]&&i._date.selectedDate.splice(e,1)}):this._date.selectedDate.push(c[d]);for(var u=0;u<this.calendarsNum;u++)this._updateDate(u),this._manageViews(u)}else this._keyboard.updateValue(this)}this._setValue()},esc:function(){this.$el.blur(),this.hide()},tab:function(){this.pickerHide=!0},gather:function(t){return{left:e.proxy(this.prevDate,t),up:e.proxy(this.upLine,t),right:e.proxy(this.nextDate,t),down:e.proxy(this.downLine,t),ctrl_left:e.proxy(this.prevPage,t),ctrl_up:e.proxy(this.higherView,t),ctrl_right:e.proxy(this.nextPage,t),alt_left:e.proxy(this.prevCalendar,t),alt_right:e.proxy(this.nextCalendar,t),enter:e.proxy(this.enter,t),esc:e.proxy(this.esc,t)}},press:function(e){var t,s=e.keyCode||e.which;e.ctrlKey?(e.preventDefault(),t=this.map[17]):e.altKey?(e.preventDefault(),t=this.map[18]):t=this.map,9===s&&this._keyboard.tab.call(this),s in t&&"function"==typeof t[s]&&(e.preventDefault(),t[s].call(this))},attach:function(e,t){var s,i=this;for(s in t)if(t.hasOwnProperty(s)){var n=[],h=e._stringSeparate(s,"_");if(1===h.length)n[0]=h[0].toUpperCase(),e.map[this.keys()[n[0]]]=t[s];else for(var r=0;r<h.length;r++)n[r]=h[r].toUpperCase(),0===r?e.map[this.keys()[n[0]]]===a&&(e.map[this.keys()[n[0]]]={}):e.map[this.keys()[n[0]]][this.keys()[n[r]]]=t[s]}e.bound||(e.bound=!0,"dropdown"===e.options.displayMode?e.$el.on("keydown.dropdown",function(t){i.press.call(e,t)}):e.$picker.on("keydown.inline",function(t){i.press.call(e,t)}))}}},l.defaults=n,e.fn[i]=function(t){if("string"!=typeof t)return this.each(function(){e.data(this,i)||e.data(this,i,new l(this,t))});var s=t,a=Array.prototype.slice.call(arguments,1);if(/^\_/.test(s))return!1;if(!/^(getWrap|getInput|getDate)$/.test(s))return this.each(function(){var t=e.data(this,i);t&&"function"==typeof t[s]&&t[s].apply(t,a)});var n=this.first().data(i);return n&&"function"==typeof n[s]?n[s].apply(n,a):void 0}}(jQuery,document,window);