function getPostiDisponibili(t){t.children("div.alert.errore");var i=t.find(".posti"),n=t.find(".data");$.post("attivita.php",{getPostiDisponibili:!0,Data:n.val()},function(n){if(n.length>0){var a=parseInt(n);t.data("posti-disponibili",a),controllaConsistenzaPosti(t,i)}else t.data("posti-disponibili",-1)})}function controllaConsistenzaPosti(t,i){var n=parseInt(t.data("posti-disponibili")),a=t.children(".alert.errore");return parseInt(i.val())>n?(notificaErrore(i,"Sono disponibili al massimo "+n+" posti.",a,t),!1):(pulisciErrori(a,t),!0)}function triggeraChangeInputData(){$(".data").on("focus",function(){var t=$(this).val();$(this).on("blur",function(){t!=$(this).val()&&$(this).trigger("change"),$(this).off("blur")})})}$(function(){$(".form-prenotazione-container").hide(),$(".solo-js").show(),$("input[name='JSAbilitato']").val("1"),$(".chiudi-form-prenotazione").on("click",function(){$(this).prev().prev().slideUp(),$(this).prev().show(),$(this).hide()}),$(".attivita > button.btn.btn-primary").on("click",function(t){var i=$(t.target).parent().children(".form-prenotazione-container");i.slideDown(function(){i.find("input.data").trigger("change"),i.find("input.data").filter(":first").focus()}),$(t.target).next().show(),$(t.target).hide()}),$("input.data").on("change",function(){getPostiDisponibili($(this).parent().parent().parent())}),$("input.data, input.posti").on("focus",function(){$(this).hasClass("error")&&$(this).removeClass("error")}),$(".form-prenotazione-container > form").on("submit",function(t){var i=$(this).find("input.data"),n=$(this).find("input.posti"),a=$(this).children(".alert.errore");pulisciErrori(a,$(this));var r=validaData(i.val());if(!r)return notificaErrore(i,"Inserire una data nel formato corretto.",a,$(this)),!1;if(r.getTime()<(new Date).getTime())return notificaErrore(i,"Impossibile prenotare per tale data. Inserire una data futura.",a,$(this)),t.preventDefault(),t.stopPropagation(),!1;if(0==n.val().length||isNaN(n.val())||parseInt(n.val())<=0)return notificaErrore(n,"Inserire un numero di posti valido (maggiore o uguale a uno)",a,$(this)),t.preventDefault(),t.stopPropagation(),!1;parseInt($(this).data("posti-disponibili"));return controllaConsistenzaPosti($(this),n)?void 0:(t.preventDefault(),t.stopPropagation(),!1)}),$("input.posti").on("input",function(t){controllaConsistenzaPosti($(this).parent().parent(),$(this));var i=parseInt($(t.target).val())*parseInt($(t.target).parent().parent().children(".prezzo-unitario").val());isNaN(i)&&(i=""),$(t.target).parent().parent().find("span.totale").text(i)}),$("input.data").asDatepicker(),triggeraChangeInputData()});